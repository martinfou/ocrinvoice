# OCR Invoice Parser - Cursor Rules

## Project Overview
This is an OCR invoice parser project that extracts structured data from PDF invoices. The project includes both CLI and GUI components, with a focus on business alias management for improving parsing accuracy.

## Current Development Phase
We are currently working on **Phase 1: Core Functionality (MVP)** of the Business Aliases GUI Manager. This is a PyQt6 desktop application for managing business name aliases used by the OCR invoice parser.

## Key Goals
- Create an intuitive GUI for managing business aliases
- Improve alias accuracy through visual feedback and validation
- Support bulk operations for enterprise users
- Maintain data integrity and provide backup/recovery
- Integrate seamlessly with existing CLI functionality

## Technical Stack
- **Backend**: Python 3.8+ with OCR capabilities (pytesseract, pdf2image, opencv)
- **GUI**: PyQt6 for desktop application
- **Data**: JSON-based alias storage with CLI compatibility
- **Testing**: pytest with pytest-qt for GUI testing
- **Code Quality**: black, flake8, mypy for linting and type checking

## Development Approach
1. **Always fix pre-commit hook issues** before committing (flake8, mypy, black)
2. **Follow the specification** in `docs/architecture/business_aliases_gui_spec.md`
3. **Maintain CLI compatibility** - GUI should use same data formats as CLI
4. **Focus on long-term maintainability** - clean code, proper error handling, comprehensive testing
5. **User experience first** - intuitive interface, helpful error messages, keyboard shortcuts
6. **Documentation standards** - User guides go in `docs/user_guide/`, architecture docs in `docs/architecture/`

## File Structure
```
src/ocrinvoice/
├── cli/                    # Command line interface
├── gui/                    # GUI components (being developed)
│   ├── main_window.py      # Main application window
│   ├── alias_table.py      # Custom table widget
│   ├── alias_form.py       # Add/edit forms
│   ├── dialogs/            # Modal dialogs
│   └── utils/              # GUI utilities
├── business/               # Business logic
├── parsers/                # Invoice parsing logic
└── utils/                  # Shared utilities

docs/
├── architecture/           # Technical specifications and architecture docs
│   ├── business_aliases_gui_spec.md
│   ├── system_architecture.md
│   └── README.md
├── user_guide/             # User-facing documentation
│   ├── getting_started.md
│   ├── cli_reference.md
│   ├── gui_guide.md        # Business Aliases GUI documentation
│   ├── configuration.md
│   └── troubleshooting.md
└── developer/              # Developer documentation
```

## Code Standards
- **Python**: Follow PEP 8, use type hints
- **PyQt6**: Use modern PyQt6 patterns, proper signal/slot connections
- **Error Handling**: Graceful degradation, user-friendly error messages
- **Testing**: Unit tests for business logic, integration tests for GUI
- **Documentation**: Clear docstrings, proper documentation structure
  - User guides: `docs/user_guide/` (e.g., `gui_guide.md`)
  - Architecture specs: `docs/architecture/` (e.g., `business_aliases_gui_spec.md`)
  - Developer docs: `docs/developer/`

## Commit Standards - CRITICAL REQUIREMENTS

### ⚠️ MANDATORY COMMIT REVIEW PROCESS ⚠️

**NEVER, EVER commit without explicit user review and approval of the commit message.**

**REQUIRED WORKFLOW:**
1. **ALWAYS** show the complete commit message to the user first
2. **ALWAYS** ask for review and approval: "Please review this commit message and approve if correct"
3. **NEVER** run `git commit` without user saying "approved" or "commit" after seeing the message
4. **NEVER** assume approval from phrases like "commit" or "go ahead" - explicit review is required
5. **ALWAYS** wait for user confirmation before executing any commit command

**EXAMPLES OF WHAT NOT TO DO:**
- ❌ User says "commit" → immediately run git commit
- ❌ User says "it works fine commit" → immediately run git commit
- ❌ User says "go ahead" → immediately run git commit
- ❌ Any variation without showing the message first

**EXAMPLES OF WHAT TO DO:**
- ✅ Show full commit message → "Please review this commit message and approve if correct"
- ✅ Wait for user to say "approved" or "looks good" → then commit
- ✅ If user says "commit" → show message first, then ask for approval

### Commit Message Requirements
- **Detailed commit messages** with comprehensive information about changes
- **Use conventional commit format**: `type(scope): description`
- **Include context** about why changes were made
- **List all major changes** in bullet points
- **Reference related issues** or specifications when applicable
- **Explain impact** on existing functionality
- **Mention testing** performed or needed

### Commit Message Template
```
type(scope): detailed description of changes

- List all major changes made
- Explain why changes were necessary
- Reference any related issues or specs
- Mention impact on existing functionality
- Note any testing performed
- Include any breaking changes or migrations needed

Example:
feat(gui): implement main window with basic table widget

- Create MainWindow class with PyQt6 QMainWindow
- Add AliasTable widget with QTableWidget
- Implement basic CRUD operations for aliases
- Add toolbar with add/edit/delete actions
- Integrate with existing BusinessAliasManager
- Add status bar with alias count display
- Follow specification from business_aliases_gui_spec.md
- Maintain CLI compatibility for data formats
- Test basic functionality with pytest-qt

```

## Important Notes
- Always consider the user experience
- Maintain backward compatibility with CLI
- Follow the detailed specification in the docs
- Focus on clean, maintainable code
- Test thoroughly before committing
- Always run the test suite after each modification.
- When working with a spec document, do a check mark beside the tasks each time you complete a task.
- **NEVER commit without user review of commit message**
- **NEVER assume approval - always ask explicitly**
- **ALWAYS show the commit message first, then ask for approval**

## ASCII Art Standards
- **Always ensure all lines align properly** when creating ASCII art mockups
- Use consistent box-drawing characters (┌─┐│└─┘├─┤) throughout
- Maintain proper spacing and indentation for visual clarity
- Ensure all borders and dividers line up perfectly
- Use monospace font considerations when designing layouts
- Test ASCII art readability in plain text editors
- Keep mockups clean and professional for documentation
